image: edbizarro/gitlab-ci-pipeline-php:7.3

composer:
 stage: build
 script:
 - composer install --prefer-dist --no-ansi --no-interaction --no-progress --no-sci
 - cp .env.example .env
 - php artisan key:generate
 artifacts:
   expire_in: 1 month
   paths:    
     - vendor/
     - .env
cache:
    key: ${CI_COMMIT_REF_SLUG}-composer
    paths:
     - vendor/

npm:
 stage: build
 script:
  - npm install
  - npm run production

 artifacts:
  expire_in: 1 month
  paths:
      - node_modules/
      - public/css/
      - public/js/
cache:
   key: ${CI_COMMIT_REF_SLUG}-npm
   paths:
      - node_modules/


testing:php:
  stage: test
  dependencies:
    - composer
  script:
  - ./vendor/bin/phpunit --coverage-text --colors=never